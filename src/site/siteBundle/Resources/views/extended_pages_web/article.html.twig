{% extends 'sitesiteBundle::base_pages.html.twig' %}
{% set cssjsloads = 'simple' %}
{% import 'sitesiteBundle:blocks:articles_actions.html.twig' as articles_macros %}
{% import 'sitesiteBundle:blocks:blocks_actions.html.twig' as blocks_actions %}
{% import 'sitesiteBundle:blocks:actions.html.twig' as actions %}
{% set EDITORMODE = (app.environment in ['DEV', 'TEST']) or (is_granted('ROLE_EDITOR')) %}

{% block mainContainer %}
<section>
	<div class="container">
		<div class="row">

			{% block menuArticle %}
			{{ render(controller('sitesiteBundle:Default:menuArticle')) }}
			{% endblock menuArticle %}

			{% if article != false and article.imageId|default(null) != null %}
			<div class="col-sm-9 col-md-9 padding-left-resp"><!--colonne right-->
				<div class="content-page-right">
					<h2 class="title">
						{{ blocks_actions.breadcrumb(article, categories|default([])|reverse) }}
						{%- if EDITORMODE %} <a {{ actions.adminHref(path('siteadmin_entite', {entite: article.className|default(article.class_name|default(null)), id: article.id, action: 'show'})) }}><i class="fa fa-eye icon-wait-on-click text-danger"></i></a>{% endif %}
						{%- if EDITORMODE %} <a {{ actions.adminHref(path('siteadmin_entite', {entite: article.className|default(article.class_name|default(null)), id: article.id, action: 'edit'})) }}><i class="fa fa-pencil icon-wait-on-click text-danger"></i></a>{% endif %}
					</h2>
					<div class="product-details background-gray"><!--product-details-->
						{% if article.imageId|default(null) != null %}
						<div class="col-sm-6">
							<div class="product-image-wrapper">
								<div class="single-products">
									{% if categories|default([]).0.imageId != null %}
									<div class="productinfo">
										<img src="{{ imageB64sized(categories.0.imageId, 64, 64) }}" alt="{{ categories.0.slug }}" />
									</div>
									{% endif %}
									<img src="{{ imageB64sized(article.imageId, 398, 279) }}" alt="{{ article.slug }}" class="img-responsive">
								</div>
							</div>
						</div><!--/col-sm-6-->
						<div class="col-sm-6">
						{% else %}
						<div class="col-sm-12">
						{% endif %}
							<div class="product-information"><!--/product-information-->
								<h2 class="m-t-xs m-b-none">{{ article.nom }}</h2>
								{% if article.accroche|default(null) != null %}
								<p><i>{{ article.accroche|raw }}</i></p>
								{% endif %}

								{% set parents = [] %}
								{% if article.nestedpositionParents|length > 0 %}
									{% for parent in article.nestedpositionParents if (parent.parent.type == 'article' and parent.parent.class_name == 'categorie') %}
										{% set parents = parents|merge([parent.parent.nom]) %}
									{% endfor %}
								{% endif %}
								{% if parents|length > 0 %}
								<p><strong>{{ parents|join(' / ') }}</strong></p>
								{% endif %}

								{% if not article.surdevis %}
								<h2 class="product-information-price">{{ articlePrix(article)|raw }}</h2>
								{% else %}
								<h2 class="product-information-price"><small>Prix sur devis</small></h2>
								{# <p><a href="#">Demander un devis</a></p> #}
								{% endif %}

								{% if marketplace.vente and article.vendable and not article.surdevis %}
								<div class="btn-group order-group commande-cmd" role="group" aria-label="..." data-article='{{ dataForPanier(article) }}'>
									<button type="button" class="btn btn-default btn-commander"><i class="fa fa-shopping-cart fa-flip-horizontal"></i> Commander</button>
									<input class="command_quantity" type="text" name="quantity" value="{{ article.defaultquantity }}{% if article.unit != null %} {{ shortUnit(article.unit) }}{% endif %}" autocomplete="off" size="10">
									<span class="btn-quantity">
										<a class="btn quantity-top"><i class="fa fa-angle-up"></i></a>
										<a class="btn quantity-bottom"><i class="fa fa-angle-down"></i></a>
									</span>
								</div>
								{% endif %}
							</div><!--/product-information-->
						</div><!--/col-sm-6-->
					</div><!--/product-details-->
					
					<!-- -->
					{% set ficherecettes = 0 %}
					{% for fiche in article.nestedpositionChilds|default([]) if fiche.child['class_name'] == 'ficherecette' %}{% set ficherecettes = ficherecettes + 1 %}{% endfor %}
					{% set ficheboissons = 0 %}
					{% for fiche in article.nestedpositionChilds|default([]) if fiche.child['class_name'] == 'ficheboisson' %}{% set ficheboissons = ficheboissons + 1 %}{% endfor %}
					<div class="category-tab shop-details-tab"><!--category-tab-->
						<div class="col-sm-12">
							<ul class="nav nav-tabs">
								<li class="active"><a href="#details" data-toggle="tab">Details du produit</a></li>
								{% if ficherecettes > 0 %}
								<li class=""><a href="#ficherecette" data-toggle="tab">Fiches recettes</a></li>
								{% endif %}
								{% if ficheboissons > 0 %}
								<li class=""><a href="#ficheboisson" data-toggle="tab">Conseil en vin</a></li>
								{% endif %}
							</ul>
						</div>
						<div class="tab-content">
							<div class="tab-pane fade active in" id="details">
								<div class="col-sm-12 p-b-sm">
									<h3 class="m-t-none">{{ article.nom }}</h3>
									{% if article.descriptif matches ('#(.)+#') %}
									{# <b>Conseil :</b></br> #}
									{# <div class="col-sm-12 padding-left-right-null"> #}
										{# <ul class="shop-details-ul"> #}
											{{ article.descriptif|raw }}
										{# </ul> #}
									{# </div> #}
									{% endif %}
								</div>
								<div class="col-sm-12 p-b-sm">
									<h4>À voir également…</h4>
								</div>
									{# <div class="col-sm-6 padding-left-right-null"> #}
									{% for artChild in article.nestedpositionChilds|default([]) if artChild.child['class_name'] == 'article' %}
										{{ articles_macros.boxArticle(artChild.child, null, {'buy': 'off', 'col': 'on'}) }}
									{% endfor %}
									{# </div> #}
							</div>
							{% if ficherecettes > 0 %}
							<div class="tab-pane fade active" id="ficherecette">
								<div class="col-sm-12">
									<div class="col-sm-6 padding-left-right-null">
										<ul class="shop-details-ul">
											{% for fiche in article.nestedpositionChilds|default([]) if fiche.child['class_name'] == 'ficherecette' %}
											<li><a href="{{ path('site_pageweb_fiche', {itemSlug: fiche.child.slug}) }}"><i class="fa fa-caret-right"></i>{{ fiche.child.nom }}</a></li>
											{% endfor %}
										</ul>
									</div>
{# 									<div class="col-sm-6 padding-left-right-null">
										<ul class="shop-details-ul">
											<li><a href="fiche_recette.html"><i class="fa fa-caret-right"></i>Côtes de veau bordelaise</a></li>
											<li><a href="fiche_recette.html"><i class="fa fa-caret-right"></i>Côtes de veau panées</a></li>
										</ul>
									</div> #}
								</div>
							</div>
							{% endif %}
							{% if ficheboissons > 0 %}
							<div class="tab-pane fade" id="ficheboisson">
								<div class="col-sm-12">
									<div class="col-sm-6 padding-left-right-null">
										<ul class="shop-details-ul">
											{% for fiche in article.nestedpositionChilds|default([]) if fiche.child['class_name'] == 'ficheboisson' %}
											<li><a href="{{ path('site_pageweb_fiche', {itemSlug: fiche.child.slug}) }}"><i class="fa fa-caret-right"></i>{{ fiche.child.nom }}</a></li>
											{% endfor %}
										</ul>
									</div>
{# 									<div class="col-sm-6 padding-left-right-null">
										<ul class="shop-details-ul">
											<li><a href="fiche_recette.html"><i class="fa fa-caret-right"></i>Côtes de veau bordelaise</a></li>
										</ul>
									</div> #}
								</div>
							</div>
							{% endif %}
							
						</div>
					</div>
				</div>
			</div>
			{% else %}
			<h3 class="text-center m-t-lg">Ce produit n'existe pas.</h3>
			{% endif %}

		</div>
	</div>
	{# {{ dump() }} #}
</section>

	{# {{ render(controller('sitesiteBundle:Default:miniListeInfo')) }}     #}

{% endblock mainContainer %}